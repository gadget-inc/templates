{% comment %} Fetching the quiz slug set in the theme customizer {% endcomment %}
{% assign quizSlug = block.settings.quiz_slug %}

{% comment %} 
  Setting `quiz_slug` is used to identify the quiz. It should match the slug of the quiz created in the app.
  The `secure_url` field is used to make calls to the store's URL to make requests to the Gadget app through the Shopify app proxy.
{% endcomment %}
<script>
  window.quizSlug = "{{ quizSlug }}";
</script>

<script src="{{ 'quiz.js' | asset_url }}" defer="defer"></script>
{{ 'quiz.css' | asset_url | stylesheet_tag }}

{% comment %} Make sure to modify this script to point to the correct endpoint for your Gadget app {% endcomment %}
<script src="https://product-quiz-public-remix-ssr--devaoc.gadget.app/api/client/web.min.js" defer="defer"></script>

<script>
  window.addEventListener("DOMContentLoaded", function() {
    window.api = new Gadget({
      /**
       * App proxy configuration:
       * Subpath prefix: `apps`
       * Subpath: Change to your non-deterministic key
       * Endpoint format: `/<subpath_prefix>/<subpath>/api/graphql`
      */
      endpoint: "/apps/product-reviews/api/graphql",
    })
  })
</script>

{% comment %} Check to see if there was a quiz slug insert into the quiz slug input in the theme customizer {% endcomment %}
{% if quizSlug.size > 0 %}
<div class="page-width page-width--narrow">
  <product-quiz class="quiz" role="main" aria-label="Product Recommendation Quiz">
    <header class="quiz-header">
      <h1 class="main-page-title page-title h0 product-quiz__title" id="quiz-title">
        Loading quiz...
      </h1>
      <div class="product-quiz__body">
        <p id="quiz-description">
          Please wait while we load your personalized quiz...
        </p>
      </div>
    </header>
    
    <form class="form" role="form" aria-label="Quiz Form">
      <div class="product-quiz__questions" id="questions" role="group" aria-label="Quiz Questions">
        <div class="product-quiz__question" role="group" aria-labelledby="question-title">
          <span class="product-quiz__question-answer" role="group" aria-label="Answer Options">
          </span>
        </div>
      </div>
      
      <hr class="product-quiz__submit-hr" aria-hidden="true" />
      
      <div class="product-quiz__email-container">
        <label for="product-quiz__email" class="email-label">
          Enter your email to get personalized results
        </label>
        <input 
          type="email" 
          id="product-quiz__email" 
          name="email" 
          required="required" 
          placeholder="your@email.com"
          aria-describedby="email-help"
          autocomplete="email"
        >
        <div id="email-help" class="sr-only">
          We'll send your personalized product recommendations to this email address
        </div>
      </div>
      
      <button
        name="quiz-submit"
        type="submit"
        class="product-quiz__submit button button--secondary"
        aria-describedby="submit-help"
      >
        <span class="button-text">Get my results</span>
        <span class="button-loading" style="display: none;">
          <span class="loading-spinner" aria-hidden="true"></span>
          Getting your results...
        </span>
      </button>
      <div id="submit-help" class="sr-only">
        Click to submit your quiz and receive personalized product recommendations
      </div>
    </form>
  </product-quiz>
</div>
{% else %}
<div>
  <h2>No quiz id added, check settings</h2>
</div>
{% endif %}

{% schema %}
{
  "name": "Quiz section",
  "target": "section",
  "settings": [
    { "type": "text", "label": "Quiz ID", "id": "quiz_slug" }
  ]
}
{% endschema %}